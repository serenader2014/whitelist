extends layout

block content

    div.wl-class
        div.navbar.navbar-inverse.navbar-fixed-top(role='navigation')
            div.container-fluid
                div.navbar-header
                    button.navbar-toggle(type='button',data-toggle='collapse',data-target='.navbar-collapse')
                        span.sr-only Toggle navigation
                        span.icon-bar  
                    a.navbar-brand(href='/') 智度
                div.navbar-collapse.collapse
                    ul.nav.navbar-nav.navbar-right
                        li: a.wl-add-product(href='javascript:;',data-toggle='modal',data-target='#add') 添加产品
                        li: a.wl-add-class(href='javascript:;',data-toggle='modal',data-target='#add') 添加分类
                    form.navbar-form.navbar-right(action='#{url}', method='get')
                        input.form-control.wl-search(type='text',placeholder='Search...', name='s')
        div.container-fluid
            div.row
                div.col-sm-3.col-md-3.sidebar
                    ul.nav.nav-sidebar.wl-list
                        li.wl-sidebar-header
                            p
                                | 产品
                                span: button.btn.btn-default.wl-btn 编辑
                        - product.product.forEach(function (item,index){
                            li
                                a(href='#{url}/#{item.name}',data-class='#{item.name}',data-id='#{item.id}',class='#{item.name}')
                                    | #{item.name}
                                    span.label.label-info.wl-caret more
                                    //- span.wl-caret-hide.wl-caret hide..
                                    span.badge.wl-weight #{item.weight}
                                div.wl-show-sub
                                    ul.nav.nav-sidebar.wl-sub-list
                        - })
                div.col-sm-9.col-sm-offset-3.col-md-9.col-md-offset-3.main
                    h2.sub-header #{product.current.name}
                    ol.breadcrumb.wl-header-nav
                        - var tmp = '';
                        - url.split('/').forEach(function (item, index) {
                            - tmp = tmp + item +'/';
                            - if (item)
                                li: a(href='#{tmp}') #{item}
                        - })
                    hr
                    div.table-responsive
                        button.btn.btn-default.wl-edit-btn(type='button') 编辑
                        table.table.table-striped
                            thead
                                tr
                                    th IP
                                    th IP
                                    th IP
                                    th IP
                            tbody.wl-product-body
                                - product.ip.forEach(function (item,index) {
                                    - if (index%4 === 0) {
                                        tr
                                    - }
                                            td
                                                a(href='javascript:;',data-id='#{item.id}')
                                                    | #{item.value}
                                - })
                        div.wl-pager
                            ul.pagination
                                li: a.wl-prev-page(href='') &laquo;
                                - for(var i = 1; i <= product.count/100; i++)
                                    - if (pageNum && pageNum*1 === i)
                                        li.active: a(href='#{url}/page/#{i}') #{i}
                                    - else
                                        li: a(href='#{url}/page/#{i}') #{i}
                                li: a.wl-next-page(href='') &raquo;
    
        div.modal.fade#add(tabindex='-1',role='dialog',aria-labelledby='myModalLabel',aria-hidden='true')
            div.modal-dialog
                div.modal-content
                    div.modal-header
                        button.close(type='button',data-dismiss='modal')
                            span(aria-hidden='true') &times;
                            span.sr-only close
                        h4.modal-title#myModalLabel 添加产品
                    div.modal-body
                        select.from-control.input-lg.wl-select
                            option(value='') something
                        select.from-control.input-lg.wl-select
                            option(value='') another
                        input.from-control.wl-input(type='text',placeholder='子产品')
                    div.modal-footer
                        button.btn.btn-default(type='button',data-dismiss='modal') Cancel
                        button.btn.btn-primary(type='button') Save changes 
    
block extra_script
    script.
        $(".wl-caret").on("click",function(event){
            event.preventDefault();
            event.stopPropagation();
            var self = this;
            if ($(self).parents("li").find(".wl-show-sub").is(":visible")) {
                $(self).parents("li").find(".wl-show-sub").hide();
                $(self).html("more");
            } else {
                var url = $(this).parent().attr("href"); 
                var reqUrl = "http://10.0.200.185:81/ls"+url;
                $.ajax({
                    type: "GET",
                    url: reqUrl,
                    crossDomain: true,
                    dataType: "jsonp",
                    success: function (data) {
                        var productData = data.product;
                        var len = productData.length;
                        if(len > 0){
                            productData.forEach(function(item,index){
                                var subProduct = item.name;
                                var weight = item.weight; 
                                console.log(subProduct);
                                console.log(weight);
                                $(self).parents("li").find(".wl-show-sub").show().find("ul").append($("<li><a href='"+url+"/"+subProduct+"'>"+subProduct+"<span class='badge wl-sub-weight'>"+weight+"</a></li>"))
                                $(self).html("hide");
                            })
                        }else if(len === 0){
                            $(self).hide();
                        }
                    }
                })
            }
        })
        $(".wl-list a").each(function (index, item) {
            $(item).editable({
                title: "Input the value",
                type: "text",
                pk: $(this).data("id"),
                url: ""
            });
        });
 
        $(".wl-list a").editable("toggleDisabled");

        //- $(".wl-sub-list a").each(function (index, item) {
            //- $(item).editable({
                //- title: "Input the value",
                //- type: "text",
                //- pk: $(this).data("id"),
                //- url: ""
            //- });
        //- });
 
        //- $(".wl-sub-list a").editable("toggleDisabled");

        $(".table a").each(function (index, item) {
            $(item).editable({
                title: "Input the value",
                type: "text",
                pk: $(this).data("id"),
                url: "/wl/ip"
            });
        });

        $(".table a").editable("toggleDisabled");

        $("body").on("click", ".wl-edit-btn", function(){
            $(".table a").editable("toggleDisabled");
            $(this).html($(this).html()==="编辑"? "取消" : "编辑");
        });
        $("body").on("click", ".wl-btn", function () {
            $(".wl-list a:not(.wl-btn)").editable("toggleDisabled");
            //- $(".wl-sub-list a:not(.wl-btn)").editable("toggleDisabled");
            $(this).html($(this).html()==="编辑" ? "取消" : "编辑");
        });
        
